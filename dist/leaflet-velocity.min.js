function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _readOnlyError(t){throw new TypeError('"'+t+'" is read-only')}function ownKeys(e,t){var o,n=Object.keys(e);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(e),t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)),n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(o),!0).forEach(function(t){_defineProperty(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function _defineProperty(t,e,o){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0===o)return("string"===e?String:Number)(t);o=o.call(t,e||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}L.DomUtil.setTransform||(L.DomUtil.setTransform=function(t,e,o){e=e||new L.Point(0,0);t.style[L.DomUtil.TRANSFORM]=(L.Browser.ie3d?"translate("+e.x+"px,"+e.y+"px)":"translate3d("+e.x+"px,"+e.y+"px,0)")+(o?" scale("+o+")":"")}),L.CanvasLayer=(L.Layer||L.Class).extend({initialize:function(t){this._map=null,this._canvas=null,this._frame=null,this._delegate=null,L.setOptions(this,t)},delegate:function(t){return this._delegate=t,this},needRedraw:function(){return this._frame||(this._frame=L.Util.requestAnimFrame(this.drawLayer,this)),this},_onLayerDidResize:function(t){this._canvas.width=t.newSize.x,this._canvas.height=t.newSize.y},_onLayerDidMove:function(){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,t),this.drawLayer()},getEvents:function(){var t={resize:this._onLayerDidResize,zoomend:this._onLayerDidMove};return this._map.options.zoomAnimation&&L.Browser.any3d&&(t.zoomanim=this._animateZoom),t},onAdd:function(t){this._map=t,this._canvas=L.DomUtil.create("canvas","leaflet-layer"),this.tiles={};var e=this._map.getSize(),e=(this._canvas.width=e.x,this._canvas.height=e.y,this._map.options.zoomAnimation&&L.Browser.any3d),e=(L.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(e?"animated":"hide")),this.options.pane.appendChild(this._canvas),t.on(this.getEvents(),this),this._delegate||this),o=(e.onLayerDidMount&&e.onLayerDidMount(),this.needRedraw(),this);setTimeout(function(){o._onLayerDidMove()},0)},onRemove:function(t){var e=this._delegate||this;e.onLayerWillUnmount&&e.onLayerWillUnmount(),this.options.pane.removeChild(this._canvas),t.off(this.getEvents(),this),this._canvas=null},addTo:function(t){return t.addLayer(this),this},drawLayer:function(){var t=this._map.getSize(),e=this._map.getBounds(),o=this._map.getZoom(),n=this._map.options.crs.project(this._map.getCenter()),i=this._map.options.crs.project(this._map.containerPointToLatLng(this._map.getSize())),a=this._delegate||this;a.onDrawLayer&&a.onDrawLayer({layer:this,canvas:this._canvas,bounds:e,size:t,zoom:o,center:n,corner:i}),this._frame=null},_setTransform:function(t,e,o){e=e||new L.Point(0,0);t.style[L.DomUtil.TRANSFORM]=(L.Browser.ie3d?"translate("+e.x+"px,"+e.y+"px)":"translate3d("+e.x+"px,"+e.y+"px,0)")+(o?" scale("+o+")":"")},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),t=L.Layer?this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(),t.zoom,t.center):this._map._getCenterOffset(t.center)._multiplyBy(-e).subtract(this._map._getMapPanePos());L.DomUtil.setTransform(this._canvas,t,e)}}),L.canvasLayer=function(t){return new L.CanvasLayer(t)},L.Control.Velocity=L.Control.extend({options:{position:"bottomleft",emptyString:"Unavailable",angleConvention:"bearingCCW",showCardinal:!1,speedUnit:"m/s",heightUnit:"m",directionString:"Direction",speedString:"Speed",heightString:"Height",onAdd:null,onRemove:null,waveMode:!1},onAdd:function(t){var e;return this._container=L.DomUtil.create("div","leaflet-control-velocity"),L.DomEvent.disableClickPropagation(this._container),t.on("mousemove",this._onMouseMove,this),this._container.innerHTML=this.options.emptyString,null!=(t=this.options.leafletVelocity)&&null!=(t=t.options)&&null!=(e=t.onAdd)&&e.call(t),this._container},onRemove:function(t){t.off("mousemove",this._onMouseMove,this),this.options.leafletVelocity.options.onRemove&&this.options.leafletVelocity.options.onRemove()},vectorToSpeed:function(t,e,o){t=Math.sqrt(Math.pow(t,2)+Math.pow(e,2));return"k/h"===o?this.meterSec2kilometerHour(t):"kt"===o?this.meterSec2Knots(t):"mph"===o?this.meterSec2milesHour(t):t},vectorToDegrees:function(t,e,o){o.endsWith("CCW")&&(e=0<e?-e:Math.abs(e));var n=Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),t=180*Math.atan2(t/n,e/n)/Math.PI+180;return"bearingCW"!==o&&"meteoCCW"!==o||360<=(t+=180)&&(t-=360),t},degreesToCardinalDirection:function(t){var e="";return 0<=t&&t<11.25||348.75<=t?e="N":11.25<=t&&t<33.75?e="NNW":33.75<=t&&t<56.25?e="NW":56.25<=t&&t<78.75?e="WNW":78.25<=t&&t<101.25?e="W":101.25<=t&&t<123.75?e="WSW":123.75<=t&&t<146.25?e="SW":146.25<=t&&t<168.75?e="SSW":168.75<=t&&t<191.25?e="S":191.25<=t&&t<213.75?e="SSE":213.75<=t&&t<236.25?e="SE":236.25<=t&&t<258.75?e="ESE":258.75<=t&&t<281.25?e="E":281.25<=t&&t<303.75?e="ENE":303.75<=t&&t<326.25?e="NE":326.25<=t&&t<348.75&&(e="NNE"),e},meterSec2Knots:function(t){return t/.514},meterSec2kilometerHour:function(t){return 3.6*t},meterSec2milesHour:function(t){return 2.23694*t},_onMouseMove:function(t){var e,o,n,i,a,t=this.options.leafletVelocity._map.containerPointToLatLng(L.point(t.containerPoint.x,t.containerPoint.y)),t=this.options.leafletVelocity._windy.interpolatePoint(t.lng,t.lat),r="";r=!t||isNaN(t[0])||isNaN(t[1])?this.options.emptyString:(e=this.vectorToDegrees(t[0],t[1],this.options.angleConvention),o=this.options.showCardinal?" (".concat(this.degreesToCardinalDirection(e),") "):"",a=i=n="",a=this.options.waveMode?(n=t[2]?t[2].toFixed(2):"No data",i=this.options.heightString,t[2]?this.options.heightUnit:""):(n=this.vectorToSpeed(t[0],t[1],this.options.speedUnit).toFixed(2),i=this.options.speedString,this.options.speedUnit),"".concat("<strong> ").concat(this.options.velocityType,": ").concat(this.options.directionString,": </strong> ").concat(e.toFixed(2),"Â°").concat(o,", <strong> ").concat(i,": </strong> ").concat(n," ").concat(a)),this._container.innerHTML=r}}),L.Map.mergeOptions({positionControl:!1}),L.Map.addInitHook(function(){this.options.positionControl&&(this.positionControl=new L.Control.MousePosition,this.addControl(this.positionControl))}),L.control.velocity=function(t){return new L.Control.Velocity(t)};var coordinateCache={},Windy=(L.VelocityLayer=(L.Layer||L.Class).extend({options:{displayValues:!0,displayOptions:{velocityType:"Velocity",position:"bottomleft",emptyString:"No velocity data"},maxVelocity:10,colorScale:null,data:null,waveMode:!1},_map:null,_canvasLayer:null,_windy:null,_context:null,_timer:0,_mouseControl:null,initialize:function(t){L.setOptions(this,t)},onAdd:function(t){this._paneName=this.options.paneName||"overlayPane";var e=t._panes.overlayPane;t.getPane&&(e=(e=t.getPane(this._paneName))||t.createPane(this._paneName)),this._canvasLayer=L.canvasLayer({pane:e}).delegate(this),this._canvasLayer.addTo(t),this._map=t},onRemove:function(t){this._destroyWind()},setData:function(t){this.options.data=t,this._windy&&(this._windy.setData(t),this._clearAndRestart()),this.fire("load")},setOpacity:function(t){this._canvasLayer.setOpacity(t)},setOptions:function(t){this.options=Object.assign(this.options,t),t.hasOwnProperty("displayOptions")&&(this.options.displayOptions=Object.assign(this.options.displayOptions,t.displayOptions),this._initMouseHandler(!0)),t.hasOwnProperty("data")&&(this.options.data=t.data),this._windy&&(this._windy.setOptions(t),t.hasOwnProperty("data")&&this._windy.setData(t.data),this._clearAndRestart()),this.fire("load")},onDrawLayer:function(t,e){this._windy?this.options.data&&(this._timer&&clearTimeout(self._timer),this._timer=setTimeout(this._clearAndRestart.bind(this),150)):this._initWindy(this)},_startWindy:function(){var t=this._map.getBounds(),e=this._map.getSize();this._windy.start([[0,0],[e.x,e.y]],e.x,e.y,[[t._southWest.lng,t._southWest.lat],[t._northEast.lng,t._northEast.lat]])},_initWindy:function(t){var e=Object.assign({canvas:t._canvasLayer._canvas,map:this._map},t.options);this._windy=new Windy(e),this._context=this._canvasLayer._canvas.getContext("2d"),this._canvasLayer._canvas.classList.add("velocity-overlay"),this.onDrawLayer(),this._map.on("zoomstart",t._windy.stop),this._map.on("zoomend",function(){return coordinateCache={},t._clearAndRestart()}),this._map.on("resize",t._clearWind),this._initMouseHandler(!1)},_initMouseHandler:function(t){t&&(this._map.removeControl(this._mouseControl),this._mouseControl=!1),!this._mouseControl&&this.options.displayValues&&(((t=this.options.displayOptions||{}).leafletVelocity=this)._mouseControl=L.control.velocity(_objectSpread(_objectSpread({},t),{},{waveMode:this.options.waveMode})).addTo(this._map))},_clearAndRestart:function(){this._context&&this._context.clearRect(0,0,3e3,3e3),this._windy&&this._startWindy()},_clearWind:function(){this._windy&&this._windy.stop(),this._context&&this._context.clearRect(0,0,3e3,3e3)},_destroyWind:function(){this._timer&&clearTimeout(this._timer),this._windy&&this._windy.stop(),this._context&&this._context.clearRect(0,0,3e3,3e3),this._mouseControl&&this._map.removeControl(this._mouseControl),this._mouseControl=null,this._windy=null,this._map.removeLayer(this._canvasLayer)}}),L.velocityLayer=function(t){return new L.VelocityLayer(t)},function(f){function c(t){return null!=t}function h(t,e){return t-e*Math.floor(t/e)}function u(t){return t/180*Math.PI}function y(l,c,t,h){var d={},t=(t.south-t.north)*(t.west-t.east),p=o*Math.pow(t,.4),u=[],y=c.x,m=2;f.map.getZoom()<10&&(m=4),function t(){for(var e=Date.now();y<c.width;){r=a=s=i=n=o=void 0;for(var o=y,n=[],i=c.y;i<=c.yMax;i+=m){var a,r,s=q(o,i);s&&(a=s[0],s=s[1],isFinite(a))&&(r=l.interpolate(a,s))&&(r=K(d,a,s,o,i,p,r),n[i+1]=n[i]=r)}if(u[o+1]=u[o]=n,y+=m,300<Date.now()-e)return void setTimeout(t,25)}U(u,c,h)}()}function m(t,a){e=E,o=T,j.indexFor=function(t){return Math.max(0,Math.min(j.length-1,Math.round((t-e)/(o-e)*(j.length-1))))};for(var e,o,r=j,s=r.map(function(){return[]}),n=Math.round(t.width*t.height*W),i=(B()&&(n*=H),f.waveMode?.89:N),i="rgba(0, 0, 0, ".concat(i,")"),l=[],c=0;c<n;c++)l.push(a.randomize({age:Math.floor(Math.random()*D)+0}));var h=f.canvas.getContext("2d");function d(){f.waveMode?(h.globalCompositeOperation="destination-in",h.fillRect(t.x,t.y,t.width,t.height),h.globalCompositeOperation="lighter",h.globalAlpha=N,s.forEach(function(t,e){0<t.length&&(h.beginPath(),h.strokeStyle=r[e],t.forEach(function(a){var t=a.xt-a.x,e=a.yt-a.y,o=Math.sqrt(t*t+e*e),r=o?-e/o:0,s=o?t/o:0,l=o?t/o:0,c=o?e/o:0;t=a.waveHeight,o=(t=>{for(var e=(t-1)/2,o=[],n=-e;n<=e;n++)o.push(n);return o})((e=t)<.5?4:e<.7?5:e<1?6:e<1.5?7:e<2?8:e<2.5?9:e<3||e<4?10:e<10?11:e<20?12:e<30?13:14);o.forEach(function(t){var e=r*t*z,o=s*t*z,t=(n=4.5,7*Math.cos(Math.abs(t)/n*(Math.PI/2))),n=a.x+e+l*t,e=a.xt+e+l*t,i=a.yt+o+c*t;h.moveTo(n,a.y+o+c*t),h.lineTo(e,i)}),a.x=a.xt,a.y=a.yt}),h.stroke())})):(h.globalCompositeOperation="destination-in",h.fillRect(t.x,t.y,t.width,t.height),h.globalCompositeOperation="lighter",h.globalAlpha=0===N?0:.9*N,s.forEach(function(t,e){0<t.length&&(h.beginPath(),h.strokeStyle=r[e],t.forEach(function(t){h.moveTo(t.x,t.y),h.lineTo(t.xt,t.yt),t.x=t.xt,t.y=t.yt}),h.stroke())}))}h.lineWidth=A,h.fillStyle=i,h.globalAlpha=f.waveMode?.2:.6;var p=Date.now();!function t(){C=requestAnimationFrame(t);var e=Date.now(),o=e-p;R<o&&(p=e-o%R,s.forEach(function(t){t.length=0}),l.forEach(function(t){t.age>D&&(a.randomize(t).age=0);var e=t.x,o=t.y,n=a(e,o),i=n[2]||2;null===(t.waveHeight=i)?t.age=D:(e=e+n[0],o=o+n[1],null!==a(e,o)[2]?(t.xt=e,t.yt=o,s[r.indexFor(i)].push(t)):(t.x=e,t.y=o)),t.age+=1}),d())}()}function _(){F.field&&F.field.release(),C&&cancelAnimationFrame(C)}f.waveMode&&(t=f.particleAge,e=f.particleMultiplier,n=f.velocityScale,Object.assign(f,{velocityScale:void 0===n?.0045:n,particleAge:void 0===t?200:t,lineWidth:1,particleMultiplier:void 0===e?1e-4:e}));var t,e,v,g,w,M,b,x,O,P,S,C,E=f.minVelocity||0,T=f.maxVelocity||10,o=(f.velocityScale||.005)*(Math.pow(window.devicePixelRatio,1/3)||1),D=f.particleAge||90,A=f.lineWidth||1,W=f.particleMultiplier||1/300,H=Math.pow(window.devicePixelRatio,1/3)||1.6,n=f.frameRate||15,R=1e3/n,N=.97,z=f.wavesParticlesSeparation||3.5,j=f.colorScale||["rgb(36,104, 180)","rgb(60,157, 194)","rgb(128,205,193 )","rgb(151,218,168 )","rgb(198,231,181)","rgb(238,247,217)","rgb(255,238,159)","rgb(252,217,125)","rgb(255,182,100)","rgb(252,150,75)","rgb(250,112,52)","rgb(245,64,32)","rgb(237,45,28)","rgb(220,24,32)","rgb(180,0,35)"],r=[NaN,NaN,null],V=f.data,i=function(n,i,h){return{header:n.header,data:function(t){var e=n.data[t],o=i.data[t];return[e,o,h?h.data[t]:Math.sqrt(e*e+o*o)]},interpolate:function(t,e,o,n,i,a){var r=1-t,s=1-e,l=r*s,s=t*s,r=r*e,t=t*e,e=o[0]*l+n[0]*s+i[0]*r+a[0]*t,c=o[1]*l+n[1]*s+i[1]*r+a[1]*t,o=h?o[2]*l+n[2]*s+i[2]*r+a[2]*t:void 0;return o<0&&(c=e=0),[e,c,o]}}},k=function(t){var e=null,o=null,n=null;return t.forEach(function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"1,2":case"2,2":e=t;break;case"1,3":case"2,3":o=t;break;default:n=t}}),i(e,o,n)},I=function(t,e){if(g){var t=h(t-M,360)/x,e=(b-e)/O,o=Math.floor(t),n=o+1,i=Math.floor(e);if(s=g[i]){var a=s[o],r=s[n],s=g[i+1];if(c(a)&&c(r)&&s){var l=s[o],s=s[n];if(c(l)&&c(s))return v.interpolate(t-o,e-i,a,r,l,s)}}}return null},B=function(){return/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)},d={},l=function(t,e,o,n,i){var a,r,s,l,c="".concat(e.toFixed(4),"_").concat(o.toFixed(4),"_").concat(n,"_").concat(i);return d[c]||(l=2*Math.PI,r=o<0?5:-5,s=p(o,e+(a=e<0?5:-5)),e=p(o+r,e),o=Math.cos(o/360*l),l=[(s[0]-n)/a/o,(s[1]-i)/a/o,(e[0]-n)/r,(e[1]-i)/r],d[c]=l)},K=function(t,e,o,n,i,a,r){var s=r[0]*a,a=r[1]*a,t=l(t,e,o,n,i);return r[0]=t[0]*s+t[2]*a,r[1]=t[1]*s+t[3]*a,r},U=function(o,i,t){function a(t,e){t=o[Math.round(t)];return t&&t[Math.round(e)]||r}a.release=function(){o=[]},a.randomize=function(t){for(var e,o,n=0;null===a(e=Math.round(Math.floor(Math.random()*i.width)+i.x),o=Math.round(Math.floor(Math.random()*i.height)+i.y))[2]&&n++<30;);return t.x=e,t.y=o,t},t(i,a)},q=function(t,e){t=f.map.containerPointToLatLng(L.point(t,e));return[t.lng,t.lat]},p=function(t,e){t=f.map.latLngToContainerPoint(L.latLng(t,e));return[t.x,t.y]},F={params:f,start:function(i,a,r,t){var e,s={south:u(t[0][1]),north:u(t[1][1]),east:u(t[1][0]),west:u(t[0][0]),width:a,height:r},t=(_(),V),o=function(t){var e,o,n;y(t,(t=a,o=r,n=(e=i)[0],e=i[1],{x:Math.round(n[0]),y:Math.max(Math.floor(n[1],0),0),xMax:t,yMax:Math.min(Math.ceil(e[1],o),o-1),width:t,height:o}),s,function(t,e){F.field=e,m(t,e)})},n=!0;(n=t.length<2?!1:n)||console.log("Windy Error: data must have at least two components (u,v)"),(n=(t=(v=k(t)).header).hasOwnProperty("gridDefinitionTemplate")&&0!=t.gridDefinitionTemplate?!1:n)||console.log("Windy Error: Only data with Latitude_Longitude coordinates is supported"),n=!0,M=t.lo1,b=t.la1,x=t.dx,O=t.dy,P=t.nx,S=t.ny,!t.hasOwnProperty("scanMode")||((e=("0"+t.scanMode.toString(2)).slice(-8).split("").map(Number).map(Boolean))[0]&&(x=-x),e[1]&&(O=-O),e[2]&&(n=!1),e[3]&&(n=!1),e[4]&&(n=!1),e[5]&&(n=!1),e[6]&&(n=!1),n=!e[7]&&n)||console.log("Windy Error: Data with scanMode: "+t.scanMode+" is not supported."),(w=new Date(t.refTime)).setHours(w.getHours()+t.forecastTime),g=[];for(var l=0,c=360<=Math.floor(P*x),h=0;h<S;h++){for(var d=[],p=0;p<P;p++,l++)d[p]=v.data(l);c&&d.push(d[0]),g[h]=d}o({date:w,interpolate:I})},stop:_,createField:U,interpolatePoint:I,setData:function(t){V=t},setOptions:function(t){t.hasOwnProperty("minVelocity")&&(t.minVelocity,_readOnlyError("MIN_VELOCITY_INTENSITY")),t.hasOwnProperty("maxVelocity")&&(t.maxVelocity,_readOnlyError("MAX_VELOCITY_INTENSITY")),t.hasOwnProperty("velocityScale")&&(t.velocityScale,Math.pow(window.devicePixelRatio,1/3),_readOnlyError("VELOCITY_SCALE")),t.hasOwnProperty("particleAge")&&(t.particleAge,_readOnlyError("MAX_PARTICLE_AGE")),t.hasOwnProperty("lineWidth")&&(t.lineWidth,_readOnlyError("PARTICLE_LINE_WIDTH")),t.hasOwnProperty("particleMultiplier")&&(t.particleMultiplier,_readOnlyError("PARTICLE_MULTIPLIER")),t.hasOwnProperty("opacity")&&(t.opacity,_readOnlyError("OPACITY")),t.hasOwnProperty("frameRate")&&(t.frameRate,_readOnlyError("FRAME_RATE")),_readOnlyError("FRAME_TIME")}};return F});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});